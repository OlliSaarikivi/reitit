<UserControl
    Name="ThisControl"
    x:Class="Reitit.LocationPicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:local="using:Reitit"
    HorizontalAlignment="Stretch">
    
    <UserControl.Resources>
        <local:LocationPickerConverter x:Key="LocationPickerConverter"/>
    </UserControl.Resources>

    <StackPanel HorizontalAlignment="Stretch">
        <TextBlock Style="{ThemeResource ControlHeaderTextBlockStyle}"
                   Text="{Binding Header, ElementName=ThisControl}"/>
        <Button Background="Transparent"
                HorizontalAlignment="Stretch"
                MinHeight="{ThemeResource ComboBoxItemMinHeightThemeSize}"
                Padding="6.5,0,0,-4.5">
            <ContentPresenter x:Name="ContentPresenter" Margin="0,2.5,0,0" MinHeight="31">
            <TextBlock x:Name="PlaceholderTextBlock"
                       Margin="0,-1.5,0,0"
                       Style="{StaticResource ComboBoxPlaceholderTextBlockStyle}"
                       Text="{Binding Value, ElementName=ThisControl, Converter={StaticResource LocationPickerConverter}}"
                       FontFamily="{ThemeResource PhoneFontFamilyNormal}"
                       FontSize="{ThemeResource ContentControlFontSize}"/>
            </ContentPresenter>
            <Button.Flyout>
                <PickerFlyout x:Name="Flyout"
                              ConfirmationButtonsVisible="True"
                              Opening="PickerFlyout_Opening"
                              Closed="PickerFlyout_Closed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <AutoSuggestBox x:Uid="LocationPickerSearchBox"
                                            Name="SearchBox"
                                            Grid.Row="0"
                                            Text="{Binding SearchTerm, Mode=TwoWay}">
                            <i:Interaction.Behaviors>
                                <core:EventTriggerBehavior EventName="KeyDown">
                                    <core:InvokeCommandAction Command="{Binding SearchCommand}"/>
                                </core:EventTriggerBehavior>
                            </i:Interaction.Behaviors>
                        </AutoSuggestBox>
                        <Grid Grid.Row="1">
                            <SemanticZoom>
                                <SemanticZoom.ZoomedInView>
                                    <ListView ItemsSource="{Binding ResultLocationGroupsSource}" SelectedItem="{Binding SelectedResult, Mode=TwoWay}"
                                              Margin="0,0,0,80">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding LongName}" 
                                                                    Style="{ThemeResource ListViewItemTextBlockStyle}"
                                                                    TextWrapping="Wrap"
                                                                    Foreground="{Binding Selected, Converter={StaticResource SelectedBrushConverter}}"/>
                                                    <TextBlock Text="{Binding Detail}"
                                                                    Visibility="{Binding Detail, Converter={StaticResource NullToVisibilityConverter}}"
                                                                    Style="{ThemeResource ListViewItemSubheaderTextBlockStyle}"
                                                                    TextWrapping="Wrap"
                                                                    Foreground="{Binding Selected, Converter={StaticResource SelectedBrushConverter}, ConverterParameter={ThemeResource ApplicationSecondaryForegroundThemeBrush}}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <ListView.HeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Key}"
                                                                Foreground="{Binding Path=DataContext.JumpingEnabled, ElementName=ThisPopup, Converter={StaticResource SelectedBrushConverter}, ConverterParameter={ThemeResource ApplicationSecondaryForegroundThemeBrush}}"
                                                                Style="{ThemeResource GroupHeaderTextBlockStyle}"/>
                                            </DataTemplate>
                                        </ListView.HeaderTemplate>
                                    </ListView>
                                </SemanticZoom.ZoomedInView>
                                <SemanticZoom.ZoomedOutView>
                                    <ListView>
                                    </ListView>
                                </SemanticZoom.ZoomedOutView>
                            </SemanticZoom>
                            <TextBlock x:Uid="LocationPickerNoResults"
                                            Style="{ThemeResource ListViewEmptyStaticTextBlockStyle}"
                                            Visibility="{Binding NoResults, Converter={StaticResource VisibilityConverter}}"/>
                        </Grid>
                    </Grid>
                    <!--</PivotItem>
                        <PivotItem x:Name="FavoritesPivotItem" Tag="{Binding FavoritesTag}">
                            <ListView ItemsSource="{Binding Favorites}"
                                        SelectedItem="{Binding SelectedFavorite, Mode=TwoWay}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}"
                                                        Style="{ThemeResource ListViewItemTextBlockStyle}"
                                                        Foreground="{Binding Selected, Converter={StaticResource SelectedBrushConverter}}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </PivotItem>
                        <PivotItem Name="RecentPivotItem" Tag="{Binding RecentTag}">
                            <ListView ItemsSource="{Binding RecentLocations}"
                                        SelectedItem="{Binding SelectedRecentLocation, Mode=TwoWay}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}"
                                                        Style="{ThemeResource ListViewItemTextBlockStyle}"
                                                        Foreground="{Binding Selected, Converter={StaticResource SelectedBrushConverter}}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </PivotItem>-->
                </PickerFlyout>
            </Button.Flyout>
        </Button>
    </StackPanel>
</UserControl>
